import  cv2
import numpy as np
import os
import re


v_seqs = ['42897599', '42897647', '42897692', '42898521', '42898538', '42898570', '42898849', '42898867', '42899459', '42899611', '45261121', '45261133', '45261143', '45261615', '45261631', '45662921', '45662942', '47115525', '47115543', '47204605', '47331651', '47331971', '47332000', '47333934', '47334107', '47334234', '47895364', '47895534', '47895542', '47895552', '48018345', '48018367', '48018382', '48458481', '48458647', '48458654']
h_seqs = ['42446540', '42897501', '42897521', '42897538', '42897545', '42897552', '42897561', '42897688', '42898486', '42898811', '42899617', '42899679', '42899691', '42899698', '42899712', '42899725', '42899729', '42899736', '43896260', '43896321', '43896330', '44358442', '44358451', '45260854', '45260898', '45260903', '45260920', '45261179', '45261575', '45261587', '45662970', '45662981', '45663113', '45663149', '45663164', '47115452', '47115469', '47204552', '47204559', '47204573', '47331068', '47331262', '47331311', '47331319', '47331661', '47331963', '47331988', '47332885', '47332893', '47332915', '47333431', '47333440', '47333452', '47333898', '47333916', '47333923', '47333927', '47334115', '47334239', '47334256', '47430475', '47430485', '47895341', '48018375', '48018559', '48018566', '48018730', '48018737', '48018947', '48458415', '48458427']
complete_h_seqs = ['42446540', '42897501', '42897521', '42897552', '42897561', '42897688', '42898486', '42898811', '42899617', '42899691', '42899712', '42899729', '42899736', '43896260', '43896321', '43896330', '44358442', '44358451', '45260854', '45260898', '45260903', '45260920', '45261179', '45261575', '45261587', '45662970', '45662981', '45663113', '45663149', '45663164', '47115452', '47115469', '47204552', '47204559', '47204573', '47331068', '47331262', '47331319', '47332885', '47332893', '47332915', '47333431', '47333440', '47333452', '47333927', '47334239', '47334256', '47430485', '48018375', '48018559', '48018566', '48018737', '48458415', '48458427']
complete_v_seqs = ['42897647', '42897692', '42898538', '42898570', '42898849', '42898867', '42899459', '42899611', '45261121', '45261133', '45261143', '45261615', '45261631', '45662921', '45662942', '47115525', '47115543', '47204605', '47331971', '47332000', '47333934', '47334107', '47334234', '47895364', '47895534', '48018367', '48458481', '48458647', '48458654']

need_rot_v_seqs = [i for i in v_seqs if i not in complete_v_seqs]
need_rot_h_seqs = [i for i in h_seqs if i not in complete_h_seqs]


# need_rot_v_seqs ['42897599', '42898521', '47331651', '47895542', '47895552', '48018345', '48018382']
# need_rot_h_seqs ['42897538', '42897545', '42899679', '42899698', '42899725', '47331311', '47331661', '47331963', '47331988', '47333898', '47333916', '47333923', '47334115', '47430475', '47895341', '48018730', '48018947']


seq = '47333431'
target_rgb = f"/media/lyq/temp/dataset/CA-1M-slam/{seq}/rgb/"
target_depth = f"/media/lyq/temp/dataset/CA-1M-slam/{seq}/depth/"

img_list  = sorted(os.listdir(target_rgb), key=lambda x: int(re.search(r'\d+', x).group()))
print(seq)
wrong_img_list = []
for idx in img_list:
    rgb_path = os.path.join(target_rgb, idx)
    depth_path = os.path.join(target_depth, idx)
    
    rgb = cv2.imread(rgb_path, cv2.IMREAD_COLOR)
    depth = cv2.imread(depth_path, cv2.IMREAD_UNCHANGED)

    if rgb is None or depth is None:
        print(f"Error reading images at {rgb_path} or {depth_path}")
        continue
    number = int(re.search(r'\d+', idx).group())
    # print(number)
    if depth.shape[0] > depth.shape[1]: 
        wrong_img_list.append(idx)
        
    if number in range(0,39):
        rotated_rgb = np.rot90(rgb, k=2)
        rotated_depth = np.rot90(depth, k=2)
        print(f"change {seq}/{idx}",  rgb.shape, depth.shape,'->', rotated_rgb.shape, rotated_depth.shape, 'rot90 k=2')


        cv2.imwrite(depth_path, rotated_depth)
        cv2.imwrite(rgb_path, rotated_rgb)



# print(f"{seq}")
# print(wrong_img_list)