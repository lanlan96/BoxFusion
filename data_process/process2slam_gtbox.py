import os
import numpy as np
import json
import cv2
import shutil
root = '/media/lyq/temp/dataset/CA-1M'
target_dir = '/media/lyq/temp/dataset/CA-1M-slam'
dir_path = os.listdir(root)

number_dir = sorted([i.split('-')[-1] for i in dir_path])
print("number dir",number_dir)



v_seqs = ['42897599', '42897647', '42897692', '42898521', '42898538', '42898570', '42898849', '42898867', '42899459', '42899611', '45261121', '45261133', '45261143', '45261615', '45261631', '45662921', '45662942', '47115525', '47115543', '47204605', '47331651', '47331971', '47332000', '47333934', '47334107', '47334234', '47895364', '47895534', '47895542', '47895552', '48018345', '48018367', '48018382', '48458481', '48458647', '48458654']
h_seqs = ['42446540', '42897501', '42897521', '42897538', '42897545', '42897552', '42897561', '42897688', '42898486', '42898811', '42899617', '42899679', '42899691', '42899698', '42899712', '42899725', '42899729', '42899736', '43896260', '43896321', '43896330', '44358442', '44358451', '45260854', '45260898', '45260903', '45260920', '45261179', '45261575', '45261587', '45662970', '45662981', '45663113', '45663149', '45663164', '47115452', '47115469', '47204552', '47204559', '47204573', '47331068', '47331262', '47331311', '47331319', '47331661', '47331963', '47331988', '47332885', '47332893', '47332915', '47333431', '47333440', '47333452', '47333898', '47333916', '47333923', '47333927', '47334115', '47334239', '47334256', '47430475', '47430485', '47895341', '48018375', '48018559', '48018566', '48018730', '48018737', '48018947', '48458415', '48458427']
complete_h_seqs = ['42446540', '42897501', '42897521', '42897552', '42897561', '42897688', '42898486', '42898811', '42899617', '42899691', '42899712', '42899729', '42899736', '43896260', '43896321', '43896330', '44358442', '44358451', '45260854', '45260898', '45260903', '45260920', '45261179', '45261575', '45261587', '45662970', '45662981', '45663113', '45663149', '45663164', '47115452', '47115469', '47204552', '47204559', '47204573', '47331068', '47331262', '47331319', '47332885', '47332893', '47332915', '47333431', '47333440', '47333452', '47333927', '47334239', '47334256', '47430485', '48018375', '48018559', '48018566', '48018737', '48458415', '48458427']
complete_v_seqs = ['42897647', '42897692', '42898538', '42898570', '42898849', '42898867', '42899459', '42899611', '45261121', '45261133', '45261143', '45261615', '45261631', '45662921', '45662942', '47115525', '47115543', '47204605', '47331971', '47332000', '47333934', '47334107', '47334234', '47895364', '47895534', '48018367', '48458481', '48458647', '48458654']


for seq in number_dir:
    os.makedirs(os.path.join(target_dir,seq),exist_ok=True)
    os.makedirs(os.path.join(target_dir,seq,"rgb"),exist_ok=True)
    os.makedirs(os.path.join(target_dir,seq,"depth"),exist_ok=True)
    second_path = os.path.join(root+"/ca1m-val-"+seq,seq)
    frames_dir = os.listdir(second_path)
    frames_dir = [i.split(".")[0] for i in frames_dir if 'world' not in i]
    idx = sorted(np.unique(frames_dir))
    count = 0
    all_poses = []
    all_K_rgb = []
    all_K_depth = []
    T_gravity = []

    first_h = 0 
    first_w = 0

    gt_ins_json = os.path.join(second_path,'world.gt','instances.json')
    t_gt_ins_json = os.path.join(os.path.join(target_dir,seq),'instances.json')
    try:
        #
        shutil.copy2(gt_ins_json, t_gt_ins_json)
        print(f"成功复制: {gt_ins_json} → {t_gt_ins_json}")
    except Exception as e:
        print(f"复制失败: {e}")

    # else:
    #     
    #     print(f"{seq} Skipping frame {frame_id} due to height mismatch. cur_d: {cur_d.shape[0]},{cur_d.shape[1]}, first_h: {first_h},{first_w}")
    print(f"finishing {seq}")






